# Dynamic configuration
http:
  routers:
    api:
      rule: "PathPrefix(`/`)"
      service: api-service
      entryPoints:
        - web
      middlewares:
        - api-retry

  services:
    api-service:
      loadBalancer:
        passHostHeader: true
        healthCheck:
          path: /health
          interval: 1s
          timeout: 300ms
        servers:
          - url: "http://api01:3000"
          - url: "http://api02:3000"
        serversTransport: fast-transport

  serversTransports:
    fast-transport:
      forwardingTimeouts:
        dialTimeout: "30s"
        responseHeaderTimeout: "10s"
        idleConnTimeout: "60s"
        readIdleTimeout: "5s"
        pingTimeout: "15s"
      maxIdleConnsPerHost: 128
      insecureSkipVerify: true

  middlewares:
    api-retry:
      retry:
        attempts: 1
        initialInterval: 100ms
